<?php
    /*Facto Bot 1.0 Beta*/
ini_set('error_reporting', E_ALL);
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
    
    include "vk.php";
    
    
    $ansver_tocken='5a549ff8';//–ö–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã —Å–µ—Ä–≤–µ—Ä–æ–º
    
    $priroda="&#128522;";
    $istoria="&#128515;";                   
    $tehnika=" &#128521;";
    /*üòÑüòÅüòäüòÉ*/ 
    $token='01bbe4290e1ca6d67e9f10cb45ca33d5c0e65ab670cbe74723f5e9c41c2c2a0792a804abb1469db66cc1d';
    
    $fact;
    $id;
    
    $category;
    
/*–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è*/
function Category($mes,$token){
    include "db.php";
    //—Ç–æ–∫–µ–Ω –ø–∞–±–ª–∏–∫–∞ (API)
    switch ($mes){
        case 1:
            $imn="priroda";//—Ñ–æ—Ç–æ
            $query_cat="priroda";
            $message ="–í–∞—à —Ñ–∞–∫—Ç –æ –ø—Ä–∏—Ä–æ–¥–µ";
             $h = 400; //–≤—ã—Å–æ—Ç–∞
             $w = 30; //—à–∏—Ä–∏–Ω–∞
            // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
            $font_size = 50;
            
            // –®–∏—Ä–∏–Ω–∞ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
            $width_text = 1800;
        break;
        
        case 2:
            $imn="chelovek";
            $message ="–í–∞—à —Ñ–∞–∫—Ç –æ —á–µ–ª–æ–≤–µ–∫–µ";
            $query_cat="chelovek";
            $h = 200; //–≤—ã—Å–æ—Ç–∞
            $w = 30; //—à–∏—Ä–∏–Ω–∞

            // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
            $font_size = 25;
            
            // –®–∏—Ä–∏–Ω–∞ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
            $width_text = 500;
        break;
    }
    
             $img="img/".$imn.".jpg";//–ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
             
             //–ó–∞–ø—Ä–æ—Å
             $query = "SELECT * FROM `".$query_cat."`";
               $res = mysql_query($query); 
                while($row = mysql_fetch_array($res))
                {
                    $array[] = $row['fact'];
               }
                
                  $number = mt_rand(0, count($array) - 1); // –ë–µ—Ä—ë–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ (–¥–ª–∏–Ω—ã –º–∞—Å—Å–∏–≤–∞ –º–∏–Ω—É—Å 1) –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
                  $fact = $array[$number]; // –í—ã–≤–æ–¥–∏–º —Ü–∏—Ç–∞—Ç—É
                    

 header("Content-type: image/jpeg");

// –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
$im = ImageCreateFromjpeg($img);

// –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞—à —Ç–µ–∫—Å—Ç –Ω–∞ –º–∞—Å—Å–∏–≤ —Å–ª–æ–≤
$arr = explode(' ', $fact);

// –í–æ–∑—Ä–∞—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –Ω—É–∂–Ω—ã–º–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Å—Ç—Ä–æ–∫, –ø–æ–∫–∞ –ø—É—Å—Ç–∞—è
$ret = "";

// –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –Ω–∞—à –º–∞—Å—Å–∏–≤ —Å–ª–æ–≤
foreach($arr as $word)
	{
		// –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ–µ —Å–ª–æ–≤–æ
		$tmp_string = $ret.' '.$word;
		
		// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞–º–∫–∏ –æ–±—Ä–∞–º–ª—è—é—â–µ–π —Ç–µ–∫—Å—Ç, —Ç.–µ. —Ä–∞–∑–º–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ 
		$textbox = imagettfbbox($font_size, 0, "fonts/consolab.ttf", $tmp_string);
		
		// –ï—Å–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–µ —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –Ω—É–∂–Ω—ã–µ –Ω–∞–º –≥—Ä–∞–Ω–∏—Ü—ã, —Ç–æ –¥–µ–ª–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏, –∏–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º –µ—â–µ –æ–¥–Ω–æ —Å–ª–æ–≤–æ
		if($textbox[2] > $width_text)
			$ret.=($ret==""?"":"\n").$word;
		else
			$ret.=($ret==""?"":" ").$word;
	}

        $color=ImageColorAllocate($im, 255, 255, 255); //–ø–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ü–≤–µ—Ç–∞

        $name="history/priroda".time().".jpg";
        /* –≤—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        imagettftext($im, $font_size, 0, $w, $h, $color, "fonts/consolab.ttf", $ret);
        imagejpeg($im,$name); //—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∏—Å—É–Ω–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG
        imagedestroy($im); //–æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
// –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º –≤–æ–∑—Ä–∞—â–µ–Ω–Ω—ã–π –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        $curl=curl_init();
        $file=$name;
        
        $file=curl_file_create($file, mime_content_type($file), pathinfo($file)['basename']);
        curl_setopt($curl, CURLOPT_URL, $result_s['response']['upload_url']);
        curl_setopt($curl, CURLOPT_POST, true);
         curl_setopt($curl,CURLOPT_HTTPHEADER, ['Content-type: multipart/form-data;charset=utf-8']);
         curl_setopt($curl, CURLOPT_POSTFIELDS, ['file'=>$file]);
         curl_setopt($curl,  CURLOPT_RETURNTRANSFER, true);
         curl_setopt($curl,  CURLOPT_TIMEOUT, 10);
         curl_setopt($curl,  CURLOPT_FOLLOWLOCATION, true);
         
        $response_image = json_decode(curl_exec($curl), true);
        curl_close($curl);
        
        $request_params = array(  
                        'server'=> $response_image['server'],
                        'photo'=>$response_image['photo'],
                        'hash'=> $response_image['hash'],
        				'access_token' => $token, 
        				'v' => '5.62' 
        				); 
        				
        	$get_params = http_build_query($request_params); 
        	$url_photo='https://api.vk.com/method/photos.saveMessagesPhoto?'.$get_params;
	        
	        $ok_image=json_decode(file_get_contents($url_photo),true);
	       
	  $request_params = array( 
      'message' => $message, 
      'attachment'=>'photo'.$ok_image['response'][0]['owner_id'].'_'.$ok_image['response'][0]['id'],
      'user_id' => $user_id, 
      'access_token' => $token, 
      'v' => '5.0' 
    ); 

$get_params = http_build_query($request_params); 

file_get_contents('https://api.vk.com/method/messages.send?'. $get_params); 

//–í–æ–∑–≤—Ä–∞—â–∞–µ–º "ok" —Å–µ—Ä–≤–µ—Ä—É Callback API 
    return('ok'); 
}

    

$request_params = array(  
        				'access_token' => $token, 
        				'v' => '5.62' 
        				); 
        				
        	$get_params = http_build_query($request_params); 
        	$server_url=file_get_contents('https://api.vk.com/method/photos.getMessagesUploadServer?'.$get_params);
	
	        $result_s=(json_decode($server_url, true));


//–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∞
       /**************************************/

        /*************************************/


if (!isset($_REQUEST)) { 
  return; 
} 

//–°—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Callback API 
$confirmation_token = $ansver_tocken; 

//–ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ 


//–ü–æ–ª—É—á–∞–µ–º –∏ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 
$data = json_decode(file_get_contents('php://input')); 

//–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–æ–ª–µ "type" 
switch ($data->type) { 
  //–ï—Å–ª–∏ —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞... 
  case 'confirmation': 
    //...–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ 
    echo $confirmation_token; 
    break; 

//–ï—Å–ª–∏ —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏... 
  case 'message_new': 
    //...–ø–æ–ª—É—á–∞–µ–º id –µ–≥–æ –∞–≤—Ç–æ—Ä–∞ 
    $user_id = $data->object->user_id; 
    //–∑–∞—Ç–µ–º —Å –ø–æ–º–æ—â—å—é users.get –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–± –∞–≤—Ç–æ—Ä–µ 
    $user_info = json_decode(file_get_contents("https://api.vk.com/method/users.get?user_ids={$user_id}&v=5.0")); 
    
//–∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ –æ—Ç–≤–µ—Ç–∞ –µ–≥–æ –∏–º—è 
    $user_name = $user_info->response[0]->first_name; 
    $ms=$data->object->body;
    
    Category($ms,$token);



   /*if ($mes!=='1'||'2'){
        $request_params = array( 
      'message' => "–í–æ—Ç —Å–ø–∏—Å–æ–∫ —Ä—É–±—Ä–∏–∫:\n 1-–ø—Ä–∏—Ä–æ–¥–∞\n2-—á–µ–ª–æ–≤–µ–∫\n\n\nPS: –ë–æ—Ç –≤ –±–µ—Ç–µ –∏ –±—É–¥–µ—Ç —Ä–∞—Å—Ç–∏ - –ø–æ—Ç–µ—Ä–ø–∏—Ç–µ))", 
      'user_id' => $user_id, 
      'access_token' => $token, 
      'v' => '5.0' 
    ); 

$get_params = http_build_query($request_params); 

file_get_contents('https://api.vk.com/method/messages.send?'. $get_params);
echo('ok'); 


}*/

}













































/*





    switch ($mes){
        case '1':
             $img="img/priroda.jpg"; //–ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
             $query = "SELECT * FROM `priroda`";
               $res = mysql_query($query); 
                while($row = mysql_fetch_array($res))
                {
                    $array[] = $row['fact'];
               }
                
                  $number = mt_rand(0, count($array) - 1); // –ë–µ—Ä—ë–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ (–¥–ª–∏–Ω—ã –º–∞—Å—Å–∏–≤–∞ –º–∏–Ω—É—Å 1) –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
                  $fact = $array[$number]; // –í—ã–≤–æ–¥–∏–º —Ü–∏—Ç–∞—Ç—É
                    

 header("Content-type: image/jpeg");
 $h = 400; //–≤—ã—Å–æ—Ç–∞
 $w = 30; //—à–∏—Ä–∏–Ω–∞
// –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
$im = ImageCreateFromjpeg($img);

// –®—Ä–∏—Ñ—Ç —Ç–µ–∫—Å—Ç–∞

// –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
$font_size = 50;

// –®–∏—Ä–∏–Ω–∞ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
$width_text = 1800;


// –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞—à —Ç–µ–∫—Å—Ç –Ω–∞ –º–∞—Å—Å–∏–≤ —Å–ª–æ–≤
$arr = explode(' ', $fact);

// –í–æ–∑—Ä–∞—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –Ω—É–∂–Ω—ã–º–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Å—Ç—Ä–æ–∫, –ø–æ–∫–∞ –ø—É—Å—Ç–∞—è
$ret = "";

// –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –Ω–∞—à –º–∞—Å—Å–∏–≤ —Å–ª–æ–≤
foreach($arr as $word)
	{
		// –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ–µ —Å–ª–æ–≤–æ
		$tmp_string = $ret.' '.$word;
		
		// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞–º–∫–∏ –æ–±—Ä–∞–º–ª—è—é—â–µ–π —Ç–µ–∫—Å—Ç, —Ç.–µ. —Ä–∞–∑–º–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ 
		$textbox = imagettfbbox($font_size, 0, "fonts/consolab.ttf", $tmp_string);
		
		// –ï—Å–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–µ —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –Ω—É–∂–Ω—ã–µ –Ω–∞–º –≥—Ä–∞–Ω–∏—Ü—ã, —Ç–æ –¥–µ–ª–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏, –∏–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º –µ—â–µ –æ–¥–Ω–æ —Å–ª–æ–≤–æ
		if($textbox[2] > $width_text)
			$ret.=($ret==""?"":"\n").$word;
		else
			$ret.=($ret==""?"":" ").$word;
	}

        $color=ImageColorAllocate($im, 255, 255, 255); //–ø–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ü–≤–µ—Ç–∞

        $name="history/priroda".time().".jpg";
        /* –≤—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        //imagettftext($im, $font_size, 0, $w, $h, $color, "fonts/consolab.ttf", $ret);
       // imagejpeg($im,$name); //—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∏—Å—É–Ω–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG
       // imagedestroy($im); //–æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
// –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º –≤–æ–∑—Ä–∞—â–µ–Ω–Ω—ã–π –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –æ—Ç—Å—Ç—É–ø–∏–º —Å–≤–µ—Ä—Ö—É –∏ —Å–ª–µ–≤–∞ –ø–æ 50px


        //$name="img/promo.jpg";
        
       // $curl=curl_init();
       // $file=$name;
        
       /* $file=curl_file_create($file, mime_content_type($file), pathinfo($file)['basename']);
        curl_setopt($curl, CURLOPT_URL, $result_s['response']['upload_url']);
        curl_setopt($curl, CURLOPT_POST, true);
         curl_setopt($curl,CURLOPT_HTTPHEADER, ['Content-type: multipart/form-data;charset=utf-8']);
         curl_setopt($curl, CURLOPT_POSTFIELDS, ['file'=>$file]);
         curl_setopt($curl,  CURLOPT_RETURNTRANSFER, true);
         curl_setopt($curl,  CURLOPT_TIMEOUT, 10);
         curl_setopt($curl,  CURLOPT_FOLLOWLOCATION, true);
         
        
        $response_image = json_decode(curl_exec($curl), true);
        curl_close($curl);
        
        //print_r($response_image);
        $request_params = array(  
                        'server'=> $response_image['server'],
                        'photo'=>$response_image['photo'],
                        'hash'=> $response_image['hash'],
        				'access_token' => $tocken, 
        				'v' => '5.62' 
        				); 
        				
        	$get_params = http_build_query($request_params); 
        	$url_photo='https://api.vk.com/method/photos.saveMessagesPhoto?'.$get_params;
	        
	        $ok_image=json_decode(file_get_contents($url_photo),true);
	       
	  $request_params = array( 
      'message' => "–í–∞—à —Ñ–∞–∫—Ç –æ –ø—Ä–∏—Ä–æ–¥–µ", 
      'attachment'=>'photo'.$ok_image['response'][0]['owner_id'].'_'.$ok_image['response'][0]['id'],
      'user_id' => $user_id, 
      'access_token' => $token, 
      'v' => '5.0' 
    ); 

$get_params = http_build_query($request_params); 

file_get_contents('https://api.vk.com/method/messages.send?'. $get_params); 

//–í–æ–∑–≤—Ä–∞—â–∞–µ–º "ok" —Å–µ—Ä–≤–µ—Ä—É Callback API 
    echo('ok'); 

break; 

case '2':
     $img="img/chelovek.jpg"; //–ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
    $query = "SELECT * FROM `chelovek`";
               $res = mysql_query($query); 
                while($row = mysql_fetch_array($res))
                {
                    $array[] = $row['fact'];
               }
                
                  $number = mt_rand(0, count($array) - 1); // –ë–µ—Ä—ë–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ (–¥–ª–∏–Ω—ã –º–∞—Å—Å–∏–≤–∞ –º–∏–Ω—É—Å 1) –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
                  $fact = $array[$number]; // –í—ã–≤–æ–¥–∏–º —Ü–∏—Ç–∞—Ç—É
                    */
    /*********************************************************************************************/                
       /* $pic = ImageCreateFromjpeg($img); //–æ—Ç–∫—Ä—ã–≤–∞–µ–º —Ä–∏—Å—É–Ω–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG
        header("Content-type: image/jpeg"); //—É–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ —Ç–∏–ø –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        $color=ImageColorAllocate($pic, 255, 255, 255); //–ø–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ü–≤–µ—Ç–∞
        
        // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ 
        $h = 200; //–≤—ã—Å–æ—Ç–∞
        $w = 30; //—à–∏—Ä–∏–Ω–∞
        
        $name="history/test".time().".jpg";
        /* –≤—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
       /* imagettftext($pic, 12, 0, $w, $h, $color, "fonts/consolab.ttf", $fact);
        imagejpeg($pic,$name); //—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∏—Å—É–Ω–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG
        imagedestroy($pic); //–æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ*/
/*header("Content-type: image/jpeg");
 $h = 200; //–≤—ã—Å–æ—Ç–∞
        $w = 30; //—à–∏—Ä–∏–Ω–∞
// –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
$im = ImageCreateFromjpeg($img);

// –®—Ä–∏—Ñ—Ç —Ç–µ–∫—Å—Ç–∞

// –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
$font_size = 25;

// –®–∏—Ä–∏–Ω–∞ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
$width_text = 500;

// –°–æ–∑–¥–∞–µ–º —Ü–≤–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è
//$blue	= imagecolorallocate($im, 0x88, 0x88, 0xFF);	// –≥–æ–ª—É–±–æ–π
//$black	= imagecolorallocate($im, 0x00, 0x00, 0x00);	// —á–µ—Ä–Ω—ã–π

// –ó–∞–ª–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–º
//imagefill($im, 1, 1, $blue);

// –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞—à —Ç–µ–∫—Å—Ç –Ω–∞ –º–∞—Å—Å–∏–≤ —Å–ª–æ–≤
$arr = explode(' ', $fact);

// –í–æ–∑—Ä–∞—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –Ω—É–∂–Ω—ã–º–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Å—Ç—Ä–æ–∫, –ø–æ–∫–∞ –ø—É—Å—Ç–∞—è
$ret = "";

// –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –Ω–∞—à –º–∞—Å—Å–∏–≤ —Å–ª–æ–≤
foreach($arr as $word)
	{
		// –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ–µ —Å–ª–æ–≤–æ
		$tmp_string = $ret.' '.$word;
		
		// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞–º–∫–∏ –æ–±—Ä–∞–º–ª—è—é—â–µ–π —Ç–µ–∫—Å—Ç, —Ç.–µ. —Ä–∞–∑–º–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ 
		$textbox = imagettfbbox($font_size, 0, "fonts/consolab.ttf", $tmp_string);
		
		// –ï—Å–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–µ —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –Ω—É–∂–Ω—ã–µ –Ω–∞–º –≥—Ä–∞–Ω–∏—Ü—ã, —Ç–æ –¥–µ–ª–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏, –∏–Ω–∞—á–µ –¥–æ–±–∞–≤–ª—è–µ–º –µ—â–µ –æ–¥–Ω–æ —Å–ª–æ–≤–æ
		if($textbox[2] > $width_text)
			$ret.=($ret==""?"":"\n").$word;
		else
			$ret.=($ret==""?"":" ").$word;
	}

        $color=ImageColorAllocate($im, 255, 255, 255); //–ø–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ü–≤–µ—Ç–∞

        $name="history/chelovek".time().".jpg";
        /* –≤—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
       // imagettftext($im, $font_size, 0, $w, $h, $color, "fonts/consolab.ttf", $ret);
        //imagejpeg($im,$name); //—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∏—Å—É–Ω–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG
       // imagedestroy($im); //–æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
// –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º –≤–æ–∑—Ä–∞—â–µ–Ω–Ω—ã–π –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –æ—Ç—Å—Ç—É–ø–∏–º —Å–≤–µ—Ä—Ö—É –∏ —Å–ª–µ–≤–∞ –ø–æ 50px


/**************************************************************************************************/
        //$name="img/promo.jpg";
        
       /* $curl=curl_init();
        $file=$name;
        
        $file=curl_file_create($file, mime_content_type($file), pathinfo($file)['basename']);
        curl_setopt($curl, CURLOPT_URL, $result_s['response']['upload_url']);
        curl_setopt($curl, CURLOPT_POST, true);
         curl_setopt($curl,CURLOPT_HTTPHEADER, ['Content-type: multipart/form-data;charset=utf-8']);
         curl_setopt($curl, CURLOPT_POSTFIELDS, ['file'=>$file]);
         curl_setopt($curl,  CURLOPT_RETURNTRANSFER, true);
         curl_setopt($curl,  CURLOPT_TIMEOUT, 10);
         curl_setopt($curl,  CURLOPT_FOLLOWLOCATION, true);
         
        
        $response_image = json_decode(curl_exec($curl), true);
        curl_close($curl);
        
        //print_r($response_image);
        $request_params = array(  
                        'server'=> $response_image['server'],
                        'photo'=>$response_image['photo'],
                        'hash'=> $response_image['hash'],
        				'access_token' => $tocken, 
        				'v' => '5.62' 
        				); 
        				
        	$get_params = http_build_query($request_params); 
        	$url_photo='https://api.vk.com/method/photos.saveMessagesPhoto?'.$get_params;
	        
	        $ok_image=json_decode(file_get_contents($url_photo),true);
	       
	  $request_params = array( 
      'message' => "–í–∞—à —Ñ–∞–∫—Ç –æ —á–µ–ª–æ–≤–µ–∫–µ", 
      'attachment'=>'photo'.$ok_image['response'][0]['owner_id'].'_'.$ok_image['response'][0]['id'],
      'user_id' => $user_id, 
      'access_token' => $token, 
      'v' => '5.0' 
    ); 

$get_params = http_build_query($request_params); 

file_get_contents('https://api.vk.com/method/messages.send?'. $get_params); 

//–í–æ–∑–≤—Ä–∞—â–∞–µ–º "ok" —Å–µ—Ä–≤–µ—Ä—É Callback API 
    echo('ok'); 

break; 
    }
//–° –ø–æ–º–æ—â—å—é messages.send –∏ —Ç–æ–∫–µ–Ω–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ 
    
} 
*/
        /*/
    
    
   
    
    /*TextOnPhoto();
?>